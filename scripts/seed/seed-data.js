// /scripts/seed/seed-data.js

function formatKST(date = new Date()) {
  // "2026.1.27 11:46:37" 형식 맞추기
  const pad = (n) => String(n).padStart(2, "0");
  const yyyy = date.getFullYear();
  const m = date.getMonth() + 1;
  const d = date.getDate();
  const hh = pad(date.getHours());
  const mm = pad(date.getMinutes());
  const ss = pad(date.getSeconds());
  return `${yyyy}.${m}.${d} ${hh}:${mm}:${ss}`;
}

// ✅ 주부(판매자) 10명
const sellers = [
  { _id: 1, seller_id: 1, name: "김미숙", gender: "F" },
  { _id: 2, seller_id: 2, name: "양정희", gender: "F" },
  { _id: 3, seller_id: 3, name: "이선영", gender: "F" },
  { _id: 4, seller_id: 4, name: "최은지", gender: "F" },
  { _id: 5, seller_id: 5, name: "정하늘", gender: "F" },
  { _id: 6, seller_id: 6, name: "강민수", gender: "M" },
  { _id: 7, seller_id: 7, name: "오준호", gender: "M" },
  { _id: 8, seller_id: 8, name: "한도윤", gender: "M" },
  { _id: 9, seller_id: 9, name: "윤재현", gender: "M" },
  { _id: 10, seller_id: 10, name: "서지훈", gender: "M" },
];

// ✅ 카테고리
const categories = [
  {
    key: "main",
    label: "메인반찬",
    items: [
      "제육볶음",
      "닭갈비",
      "돈까스",
      "떡갈비",
      "불고기",
      "고등어구이",
      "삼겹김치볶음",
      "LA갈비",
      "훈제오리볶음",
      "보쌈",
    ],
  },
  {
    key: "soup",
    label: "국물",
    items: [
      "김치찌개",
      "된장찌개",
      "순두부찌개",
      "미역국",
      "떡국",
      "육개장",
      "콩나물국",
      "감자탕",
      "갈비탕",
      "북엇국",
    ],
  },
  {
    key: "side",
    label: "밑반찬",
    items: [
      "오이무침",
      "콩자반",
      "무생채",
      "시금치나물",
      "도라지무침",
      "멸치볶음",
      "계란말이",
      "진미채무침",
      "감자샐러드",
      "고사리나물",
    ],
  },
  {
    key: "stir",
    label: "볶음",
    items: [
      "소시지야채볶음",
      "새우볶음",
      "오징어볶음",
      "김치볶음",
      "버섯볶음",
      "어묵볶음",
      "두부김치",
      "가지볶음",
      "닭똥집볶음",
      "주꾸미볶음",
    ],
  },
  {
    key: "braise",
    label: "조림",
    items: [
      "장조림",
      "감자조림",
      "꽁치김치조림",
      "두부조림",
      "코다리조림",
      "메추리알장조림",
      "갈치조림",
      "연근조림",
      "무조림",
      "우엉조림",
    ],
  },
  {
    key: "steam",
    label: "찜",
    items: [
      "계란찜",
      "갈비찜",
      "닭찜",
      "등갈비찜",
      "아구찜",
      "콩나물찜",
      "해물찜",
      "단호박찜",
      "만두찜",
      "수육찜",
    ],
  },
  {
    key: "fry",
    label: "튀김",
    items: [
      "새우튀김",
      "김말이튀김",
      "고구마튀김",
      "오징어튀김",
      "야채튀김",
      "만두튀김",
      "닭강정",
      "돈가스",
      "치킨가라아게",
      "고추튀김",
    ],
  },
];

const defaultPickupPlace = "서교동 공유주방";
const defaultServing = "2인분";

// 요리명 → 재료 매핑
const ingredientsByName = {
  // =========================
  // 메인반찬(main)
  // =========================
  제육볶음: ["돼지고기", "고추장", "양파", "대파", "마늘"],
  닭갈비: ["닭고기", "고추장", "양배추", "고구마", "떡"],
  돈까스: ["돼지고기", "빵가루", "계란", "밀가루", "돈까스소스"],
  떡갈비: ["다진소고기", "다진돼지고기", "양파", "간장", "마늘"],
  불고기: ["소고기", "간장", "양파", "대파", "배즙"],
  고등어구이: ["고등어", "소금", "레몬", "후추", "식용유"],
  삼겹김치볶음: ["삼겹살", "김치", "양파", "대파", "고춧가루"],
  LA갈비: ["LA갈비", "간장", "양파", "마늘", "배즙"],
  훈제오리볶음: ["훈제오리", "양배추", "부추", "양파", "간장"],
  보쌈: ["돼지고기", "된장", "마늘", "생강", "새우젓"],

  // =========================
  // 국물(soup)
  // =========================
  김치찌개: ["돼지고기", "김치", "두부", "대파", "고춧가루"],
  된장찌개: ["된장", "애호박", "두부", "양파", "대파"],
  순두부찌개: ["순두부", "계란", "양파", "대파", "고춧가루"],
  미역국: ["미역", "소고기", "국간장", "마늘", "참기름"],
  떡국: ["가래떡", "사골육수", "대파", "계란", "김가루"],
  육개장: ["소고기", "고사리", "대파", "고춧가루", "숙주"],
  콩나물국: ["콩나물", "대파", "마늘", "국간장", "고춧가루"],
  감자탕: ["등뼈", "감자", "시래기", "들깨가루", "대파"],
  갈비탕: ["소갈비", "무", "대파", "마늘", "후추"],
  북엇국: ["북어", "무", "대파", "마늘", "계란"],

  // =========================
  // 밑반찬(side)
  // =========================
  오이무침: ["오이", "고춧가루", "식초", "마늘", "참기름"],
  콩자반: ["검은콩", "간장", "올리고당", "마늘", "참기름"],
  무생채: ["무", "고춧가루", "식초", "마늘", "대파"],
  시금치나물: ["시금치", "마늘", "참기름", "소금", "깨"],
  도라지무침: ["도라지", "고춧가루", "식초", "마늘", "설탕"],
  멸치볶음: ["멸치", "간장", "마늘", "설탕", "견과류"],
  계란말이: ["계란", "당근", "대파", "소금", "식용유"],
  진미채무침: ["진미채", "고추장", "마요네즈", "마늘", "올리고당"],
  감자샐러드: ["감자", "마요네즈", "오이", "당근", "햄"],
  고사리나물: ["고사리", "간장", "마늘", "대파", "참기름"],

  // =========================
  // 볶음(stir)
  // =========================
  소시지야채볶음: ["소시지", "양파", "피망", "케첩", "마늘"],
  새우볶음: ["새우", "마늘", "버터", "파슬리", "소금"],
  오징어볶음: ["오징어", "고추장", "양파", "대파", "마늘"],
  김치볶음: ["김치", "양파", "대파", "고춧가루", "참기름"],
  버섯볶음: ["버섯", "양파", "대파", "간장", "마늘"],
  어묵볶음: ["어묵", "양파", "간장", "대파", "마늘"],
  두부김치: ["두부", "김치", "대파", "양파", "고춧가루"],
  가지볶음: ["가지", "간장", "마늘", "대파", "참기름"],
  닭똥집볶음: ["닭똥집", "마늘", "대파", "간장", "후추"],
  주꾸미볶음: ["주꾸미", "고추장", "양파", "대파", "마늘"],

  // =========================
  // 조림(braise)
  // =========================
  장조림: ["소고기", "간장", "마늘", "꽈리고추", "메추리알"],
  감자조림: ["감자", "간장", "양파", "올리고당", "대파"],
  꽁치김치조림: ["꽁치", "김치", "대파", "고춧가루", "마늘"],
  두부조림: ["두부", "간장", "고춧가루", "대파", "마늘"],
  코다리조림: ["코다리", "무", "고춧가루", "대파", "마늘"],
  메추리알장조림: ["메추리알", "간장", "마늘", "꽈리고추", "양파"],
  갈치조림: ["갈치", "무", "고춧가루", "대파", "마늘"],
  연근조림: ["연근", "간장", "올리고당", "식초", "참기름"],
  무조림: ["무", "간장", "고춧가루", "대파", "마늘"],
  우엉조림: ["우엉", "간장", "올리고당", "식초", "깨"],

  // =========================
  // 찜(steam)
  // =========================
  계란찜: ["계란", "물", "소금", "대파", "새우젓"],
  갈비찜: ["소갈비", "간장", "당근", "무", "마늘"],
  닭찜: ["닭고기", "간장", "감자", "당근", "대파"],
  등갈비찜: ["등갈비", "간장", "마늘", "양파", "당근"],
  아구찜: ["아구", "콩나물", "고춧가루", "대파", "마늘"],
  콩나물찜: ["콩나물", "고춧가루", "대파", "마늘", "간장"],
  해물찜: ["오징어", "새우", "홍합", "고춧가루", "대파"],
  단호박찜: ["단호박", "꿀", "견과류", "우유", "소금"],
  만두찜: ["만두", "양배추", "대파", "간장", "식초"],
  수육찜: ["돼지고기", "된장", "마늘", "생강", "양파"],

  // =========================
  // 튀김(fry)
  // =========================
  새우튀김: ["새우", "튀김가루", "계란", "빵가루", "식용유"],
  김말이튀김: ["김말이", "튀김가루", "계란", "빵가루", "식용유"],
  고구마튀김: ["고구마", "튀김가루", "계란", "식용유", "소금"],
  오징어튀김: ["오징어", "튀김가루", "계란", "빵가루", "식용유"],
  야채튀김: ["당근", "양파", "깻잎", "튀김가루", "식용유"],
  만두튀김: ["만두", "식용유", "간장", "식초", "고춧가루"],
  닭강정: ["닭고기", "튀김가루", "간장", "올리고당", "마늘"],
  돈가스: ["돼지고기", "빵가루", "계란", "밀가루", "돈까스소스"],
  치킨가라아게: ["닭고기", "간장", "마늘", "전분", "식용유"],
  고추튀김: ["고추", "돼지고기", "당면", "튀김가루", "식용유"],
};

// 매핑이 없는 음식은 카테고리별 기본 재료로 채움
const fallbackIngredientsByCategory = {
  main: ["고기", "양파", "대파", "마늘"],
  soup: ["육수", "두부", "대파", "양파"],
  side: ["채소", "양념", "참기름"],
  stir: ["재료", "양파", "대파", "양념"],
  braise: ["주재료", "간장", "마늘", "양파"],
  steam: ["주재료", "대파", "소금"],
  fry: ["주재료", "튀김가루", "식용유"],
};

function getIngredients(name, categoryKey) {
  return (
    ingredientsByName[name] ??
    fallbackIngredientsByCategory[categoryKey] ?? ["재료", "양념"]
  );
}

function makeImageUrl(categoryKey, index) {
  // 외부 이미지 placeholder (프론트에서 쓸 경우 next/image remotePatterns 설정 필요)
  return `https://picsum.photos/seed/eatda-${categoryKey}-${index}/600/600`;
}

function randomBetween(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function randomPrice(min, max, unit = 100) {
  const minUnit = Math.ceil(min / unit);
  const maxUnit = Math.floor(max / unit);
  return randomBetween(minUnit, maxUnit) * unit;
}

function pickSellerIdByIndex(i) {
  // 제품 인덱스에 따라 판매자 10명에 분배
  return sellers[(i - 1) % sellers.length].seller_id;
}

function createProducts({ startId = 1 } = {}) {
  const now = formatKST(new Date());
  let id = startId;

  const products = [];

  const priceRangeByCategory = {
    main: [9000, 16000],
    soup: [7000, 12000],
    side: [3000, 8000],
    stir: [6000, 12000],
    braise: [7000, 14000],
    steam: [7000, 15000],
    fry: [5000, 11000],
  };

  categories.forEach((cat) => {
    const [min, max] = priceRangeByCategory[cat.key] ?? [4500, 16000];

    cat.items.forEach((name, idx) => {
      const sellerId = pickSellerIdByIndex(id);

      products.push({
        _id: id,
        createdAt: now,
        updatedAt: now,
        seller_id: sellerId,
        price: randomPrice(min, max),
        show: true,
        active: true,
        name,
        quantity: randomBetween(30, 300),
        buyQuantity: randomBetween(0, 30),
        mainImages: [
          {
            path: makeImageUrl(cat.key, idx + 1),
            name: `banchan_${cat.key}_${String(idx + 1).padStart(2, "0")}.png`,
          },
        ],
        content: `${sellers[sellerId - 1].name} 주부님이 만든 ${name}`,
        extra: {
          isNew: idx < 3,
          isBest: idx % 4 === 0,
          category: [cat.key],
          categoryLabel: cat.label,

          // ✅ 상세용 확장 데이터
          ingredients: getIngredients(name, cat.key),
          serving: defaultServing,
          pickupPlace: defaultPickupPlace,
        },
      });

      id += 1;
    });
  });

  return products;
}

const products = createProducts({ startId: 1 });

module.exports = {
  sellers,
  products,
};
